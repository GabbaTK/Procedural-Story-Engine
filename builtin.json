{
    "action_maps": {
        "chest": {
            "inspect": "builtin/inspect",
            "open": "builtin/open",
            "close": "builtin/close",
            "lock": "builtin/lock",
            "unlock": "builtin/unlock",
            "gather": "builtin/gather"
        },
        "exit": {
            "leave": "builtin/leave"
        }
    },
    "actions": {
        "inspect": "display_text:\n  text_template: current_entity.properties.inspect_text",
        "open": "if:\n  a: current_entity.properties.locked\n  op: ==\n  b: false\n  exec:\n    set:\n      field: current_entity.properties.open\n      value: true\n    show_content: current_entity.properties.contents\nelse:\n  display_text:\n    text: It is locked",
        "close": "set:\n  field: current_entity.properties.open\n  value: false\ndisplay_text:\n  text: You close it.",
        "lock": "set:\n  field: flags.loop_found_val\n  value: false\nif#canlock:\n  a: current_entity.properties.can_lock\n  op: ==\n  b: false\n  exec:\n    display_text:\n      text: This entity cannot be locked\nelse:\n  for:\n    iter: player.inventory\n    exec:\n      if:\n        a: current_item.id\n        op: ==\n        b: STR:key\n        exec:\n          if:\n            a: current_item.lock_id\n            op: ==\n            b: current_entity.properties.key_id\n            exec:\n              break: null\n              set#flag:\n                field: flags.loop_found_val\n                value: true\n              if:\n                a: current_entity.properties.open\n                op: ==\n                b: true\n                exec:\n                  display_text:\n                    text: Close it first\n              else:\n                set#locked:\n                  field: current_entity.properties.locked\n                  value: true\n                display_text:\n                  text: Locked\n  if#keyfound:\n    a: flags.loop_found_val\n    op: ==\n    b: false\n    exec:\n      display_text:\n        text: You do not have the correct key",
        "unlock": "set:\n  field: flags.loop_found_val\n  value: false\nfor:\n  iter: player.inventory\n  exec:\n    if:\n      a: current_item.id\n      op: ==\n      b: STR:key\n      exec:\n        if:\n          a: current_item.lock_id\n          op: ==\n          b: current_entity.properties.key_id\n          exec:\n            set#locked:\n              field: current_entity.properties.locked\n              value: false\n            display_text:\n              text: Unlocked\n            set#flag:\n              field: flags.loop_found_val\n              value: true\n            break: null\nif:\n  a: flags.loop_found_val\n  op: ==\n  b: false\n  exec:\n    display_text:\n      text: You do not have the correct key",
        "gather": "if:\n  a: current_entity.properties.open\n  op: ==\n  b: true\n  exec:\n    for:\n      iter: current_entity.properties.contents\n      exec:\n        add:\n          field: player.inventory\n          value_template: current_item\n        remove:\n          field: current_entity.properties.contents\n          idx: 0\n    display_text:\n      text: You pick up the items\nelse:\n  display_text:\n    text: Open it first",
        "leave": "set:\n  field: flags.loop_found_val\n  value: 0\nfor:\n  iter: current_room.generators\n  exec:\n    if#specific:\n      a: current_item.exit\n      op: ==\n      b: current_entity.id\n      exec:\n        break: null\n        set:\n          field: flags.loop_found_val\n          value_template: current_item\n    if#matchall:\n      a: current_item.exit\n      op: ==\n      b: null\n      exec:\n        break: null\n        set:\n          field: flags.loop_found_val\n          value_template: current_item\nif:\n  a: flags.loop_found_val\n  op: =!\n  b: 0\n  exec:\n    if#forced:\n      a: flags.loop_found_val.type\n      op: ==\n      b: STR:forced\n      exec:\n        change_room: current_item.room\n        spawn_player: flags.loop_found_val.exit\n    if#conditional:\n      a: flags.loop_found_val.type\n      op: ==\n      b: STR:conditional\n      exec:\n        for:\n          iter: flags.loop_found_val.conditions\n          exec:\n            if#if:\n              a: current_item.type\n              op: ==\n              b: STR:if\n              exec:\n                if:\n                  a: current_item.a\n                  op: current_item.op\n                  b: current_item.b\n                  exec:\n                    change_room: current_item.room\n                    spawn_player: flags.loop_found_val.exit\n                    break: null\n            if#room:\n              a: current_item.type\n              op: ==\n              b: STR:room\n              exec:\n                change_room: current_item.room\n                spawn_player: flags.loop_found_val.exit\n                break: null\n    if#random:\n      a: flags.loop_found_val.type\n      op: ==\n      b: STR:random\n      exec:\n        random#reset:\n          action: reset\n        for:\n          iter: flags.loop_found_val.pool\n          exec:\n            random:\n              action: add\n              data:\n                current_item.room: current_item.weight\n        random#get:\n          action: start\n        change_room: flags._random\n        spawn_player: flags.loop_found_val.exit\n    if#plugin:\n      a: flags.loop_found_val.type\n      op: ==\n      b: STR:plugin\n      exec:\n        py: TEMP:flags.loop_found_val.handler"
    }
}
